@startuml AirlineReservationFacade
!theme plain
skinparam classBackgroundColor #F0F8FF
skinparam classBorderColor #00008B
skinparam classArrowColor #000000
skinparam padding 20
skinparam packageBackgroundColor #FFFACD
skinparam packageBorderColor #8B7500
skinparam nodesep 80
skinparam ranksep 100
skinparam arrowThickness 1.5
skinparam linetype ortho

package "Clients (GUI Layer)" #LIGHTBLUE {
    class LoginScreen
    class AdminGUI
    class PassengerGUI
    class StaffGUI
    class MainApp
}

package "Facade Layer (Service Managers)" #LIGHTYELLOW {
    class AuthService {
        + {static} login(username, password): boolean
        + {static} register(username, password, role): void
        + {static} getCurrentUser(): User
        + {static} logout(): void
        - {static} currentUser: User
        - {static} userDao: UserDAOImpl
    }

    class FlightManager {
        - {static} instance: FlightManager
        - flightDao: FlightDAOImpl
        + {static} getInstance(): FlightManager
        + getAvailableFlights(departure, arrival): List<Flight>
        + findFlight(flightNum): Flight
        + getAllFlights(): List<Flight>
        + createAndSaveFlight(...): void
        + deleteFlightWithIntegrity(flightNum): void
        + getUniqueCities(): String[]
    }

    class ReservationManager {
        - {static} instance: ReservationManager
        - reservationDao: ReservationDAOImpl
        - seatDao: SeatDAOImpl
        + {static} getInstance(): ReservationManager
        + createReservation(flightNum, passengerId, seatNum, weight): Reservation
        + cancelReservation(reservationCode): boolean
        + reserveRandomSeat(matrix, isSynchronized): void
    }

    class SeatManager {
        - {static} instance: SeatManager
        + {static} getInstance(): SeatManager
        + createSeatingArrangement(planeID, capacity): Seat[][]
        + reserveSeat(matrix, seatNum): void
        + emptySeatsCount(matrix): int
    }
}

package "Service Layer" #LIGHTGREEN {
    class CalculatePrice {
        + getFinalPrice(basePrice, seatClass): double
        + getAllowance(seatClass): double
        + calculateBaggageSurcharge(weight, seatClass): double
    }

    interface PricingStrategy {
        + calculate(basePrice): double
    }

    class BusinessPricing
    class EconomyPricing
}

package "Persistence Layer (DAO)" #LIGHTCORAL {
    interface GenericDAO<T, ID> {
        + save(entity): void
        + getAll(): List<T>
        + update(entity): void
        + delete(id): void
        + findById(id): T
    }

    abstract class AbstractCSVDAO<T, ID> {
        # filePath: String
        + save(entity): void
        + getAll(): List<T>
        + update(entity): void
        + delete(id): void
        + findById(id): T
        + saveAll(entities): void
    }

    class FlightDAOImpl
    class PassengerDAOImpl
    class ReservationDAOImpl {
        + getReservationsByPassenger(passengerId): List
        + getReservationsByFlight(flightNum): List
    }
    class SeatDAOImpl {
        + getSeatsByPlane(planeID): List
    }
    class UserDAOImpl {
        + deleteByUsername(username): void
    }
    class PlaneDAOImpl
}

package "Model Layer" #LAVENDER {
    class User {
        - username: String
        - password: String
        - role: String
    }

    class Flight {
        - flightNum: int
        - route: Route
        - date: String
        - hour: float
        - duration: float
        - plane: Plane
    }

    class Reservation {
        - reservationCode: String
        - flightNum: String
        - passengerID: String
        - seatNum: String
        - ticket: Ticket
    }

    class Seat {
        - seatNum: String
        - planeID: String
        - seatClass: SeatClass
        - price: double
        - reserved: boolean
    }

    class Passenger {
        - passengerID: String
        - name: String
        - surname: String
        - contactInfo: String
    }

    class Plane {
        - planeID: String
        - capacity: int
        - seatMatrix: Seat[][]
    }

    class Route {
        - departurePlace: String
        - arrivalPlace: String
        - transferPlace: String
    }

    class Ticket {
        - ticketID: String
        - price: double
        - baggage: Baggage
    }

    class Baggage {
        - weight: double
    }
}

package "Threading Layer" #LIGHTGRAY {
    class ReportGenerator {
        + run(): void
    }
}

interface CSVConvertible {
    + toCSV(): String
    + fromCSV(row): void
    + getId(): String
}

' ===== Client to Facade Relationships =====
LoginScreen --> AuthService : uses
AdminGUI -down-> FlightManager : uses
AdminGUI -down-> ReservationManager : uses
AdminGUI -down-> SeatManager : uses
AdminGUI -down-> AuthService : uses
PassengerGUI -down-> FlightManager : uses
PassengerGUI -down-> ReservationManager : uses
PassengerGUI -down-> SeatManager : uses
PassengerGUI -down-> AuthService : uses
StaffGUI -down-> FlightManager : uses
StaffGUI -down-> SeatManager : uses
StaffGUI -down-> AuthService : uses
MainApp -.down-> LoginScreen : launches

' ===== Facade to Service Relationships =====
ReservationManager -down-> CalculatePrice : uses
CalculatePrice -down-> PricingStrategy : delegates to

' ===== Service to Subsystem Relationships =====
PricingStrategy <|-- BusinessPricing
PricingStrategy <|-- EconomyPricing

' ===== Facade to DAO Relationships =====
AuthService -right-> UserDAOImpl : delegates to
FlightManager -down-> FlightDAOImpl : delegates to
FlightManager -down-> ReservationDAOImpl : uses
FlightManager -down-> SeatDAOImpl : uses
ReservationManager -down-> ReservationDAOImpl : delegates to
ReservationManager -down-> SeatDAOImpl : delegates to
SeatManager -.down-> SeatDAOImpl : uses (optional)

' ===== DAO Inheritance =====
GenericDAO <|.. AbstractCSVDAO
AbstractCSVDAO <|-- FlightDAOImpl
AbstractCSVDAO <|-- PassengerDAOImpl
AbstractCSVDAO <|-- ReservationDAOImpl
AbstractCSVDAO <|-- SeatDAOImpl
AbstractCSVDAO <|-- UserDAOImpl
AbstractCSVDAO <|-- PlaneDAOImpl

' ===== Model Relationships =====
Flight --> Route : contains
Flight --> Plane : uses
Reservation --> Ticket : contains
Ticket --> Baggage : contains
Reservation --> Seat : references
User <|-- Passenger : inheritance

' ===== CSVConvertible Implementation =====
CSVConvertible <|.. User
CSVConvertible <|.. Flight
CSVConvertible <|.. Passenger
CSVConvertible <|.. Reservation
CSVConvertible <|.. Seat
CSVConvertible <|.. Plane

' ===== Threading =====
ReportGenerator -.right-> FlightManager : uses data from

' ===== Legend =====
note right of AuthService
    Facade: Simplifies user authentication
    Hides UserDAOImpl complexity
end note

note right of FlightManager
    Facade: Manages all flight operations
    Hides FlightDAOImpl, SeatDAOImpl, ReservationDAOImpl
    Handles business logic: availability, deletion with integrity
end note

note right of ReservationManager
    Facade: Manages reservations
    Hides ReservationDAOImpl, SeatDAOImpl complexity
    Integrates pricing calculations
    Handles threading scenarios
end note

note right of SeatManager
    Facade: Manages seat operations
    Creates seating arrangements
    Handles seat reservations and counting
end note

@enduml
